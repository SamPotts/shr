function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var getConstructor=function(t){return null!=t?t.constructor:null},instanceOf=function(t,e){return!!(t&&e&&t instanceof e)},isNullOrUndefined=function(t){return null==t},isObject=function(t){return getConstructor(t)===Object},isNumber=function(t){return getConstructor(t)===Number&&!Number.isNaN(t)},isString=function(t){return getConstructor(t)===String},isBoolean=function(t){return getConstructor(t)===Boolean},isFunction=function(t){return getConstructor(t)===Function},isArray=function(t){return Array.isArray(t)},isNodeList=function(t){return instanceOf(t,NodeList)},isElement=function(t){return instanceOf(t,Element)},isEvent=function(t){return instanceOf(t,Event)},isEmpty=function(t){return isNullOrUndefined(t)||(isString(t)||isArray(t)||isNodeList(t))&&!t.length||isObject(t)&&!Object.keys(t).length},is={nullOrUndefined:isNullOrUndefined,object:isObject,number:isNumber,string:isString,boolean:isBoolean,function:isFunction,array:isArray,nodeList:isNodeList,element:isElement,event:isEvent,empty:isEmpty},constants={facebook:{domain:"facebook.com",url:function(t){return"https://graph.facebook.com/?id=".concat(t)},shareCount:function(t){return t.share.share_count}},twitter:{domain:"twitter.com",url:function(){return null},shareCount:function(){return null}},pinterest:{domain:"pinterest.com",url:function(t){return"https://widgets.pinterest.com/v1/urls/count.json?url=".concat(t)},shareCount:function(t){return t.count}},github:{domain:"github.com",url:function(t,e){return"https://api.github.com/repos".concat(t).concat(is.string(e)?"?access_token=".concat(e):"")},shareCount:function(t){return t.data.stargazers_count}},youtube_subscribe:{domain:"youtube.com",url:function(t,e){return"https://www.googleapis.com/youtube/v3/channels?part=statistics&forUsername=".concat(t,"&key=").concat(e)},shareCount:function(t){return is.empty(t.error)?t.items[0].statistics.subscriberCount:null}}},defaults={debug:!1,count:{classname:"shr-count",displayZero:!0,format:!0,position:"after",increment:!0,html:function(t,e,n){return'<span class="'.concat(e," ").concat(e,"--").concat(n,'">').concat(t,"</span>")}},networks:{facebook:{popup:{width:640,height:270}},twitter:{popup:{width:640,height:240}},pinterest:{popup:{width:750,height:550}},github:{tokens:{}},youtube_subscribe:{channel:"",key:""}},storage:{enabled:!0,key:"shr",ttl:3e5}};function getJSONP(t){return new Promise(function(e,n){var r="jsonp_callback_".concat(Math.round(1e5*Math.random())),o=document.createElement("script");o.addEventListener("error",function(t){return n(t)}),window[r]=function(t){delete window[r],document.body.removeChild(o),e(t)};var i=new URL(t);i.searchParams.set("callback",r),o.setAttribute("src",i.toString()),document.body.appendChild(o)})}var noop=function(){},Console=function(){function t(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];_classCallCheck(this,t),this.enabled=window.console&&e,this.enabled&&this.log("Debugging enabled")}return _createClass(t,[{key:"log",get:function(){return this.enabled?Function.prototype.bind.call(console.log,console):noop}},{key:"warn",get:function(){return this.enabled?Function.prototype.bind.call(console.warn,console):noop}},{key:"error",get:function(){return this.enabled?Function.prototype.bind.call(console.error,console):noop}}]),t}();function matches(t,e){return function(){return Array.from(document.querySelectorAll(e)).includes(this)}.call(t,e)}function formatNumber(t){var e=/\./.test(1.1.toLocaleString())?".":",",n=new RegExp("\\".concat(e,"\\d+$"));return Math.round(t).toLocaleString().replace(n,"")}function extend(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(!n.length)return t;var o=n.shift();return is.object(o)?(Object.keys(o).forEach(function(e){is.object(o[e])?(!Object.keys(t).includes(e)&&Object.assign(t,_defineProperty({},e,{})),extend(t[e],o[e])):Object.assign(t,_defineProperty({},e,o[e]))}),extend.apply(void 0,[t].concat(n))):t}var Storage=function(){function t(e,n){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];_classCallCheck(this,t),this.enabled=r&&t.supported,this.key=e,this.ttl=n}return _createClass(t,[{key:"get",value:function(e){if(!t.supported||!this.enabled)return null;var n=window.localStorage.getItem(this.key);if(is.empty(n))return null;var r=window.localStorage.getItem("".concat(this.key,"_ttl"));if(is.empty(r)||r>Date.now())return null;var o=JSON.parse(n);return is.string(e)&&e.length?o[e]:o}},{key:"set",value:function(e){if(t.supported&&this.enabled&&is.object(e)){var n=this.get();is.empty(n)&&(n={}),extend(n,e),window.localStorage.setItem(this.key,JSON.stringify(n)),window.localStorage.setItem("".concat(this.key,"_ttl"),Date.now()+this.ttl)}}}],[{key:"supported",get:function(){try{return"localStorage"in window&&(window.localStorage.setItem("___test","___test"),window.localStorage.removeItem("___test"),!0)}catch(t){return!1}}}]),t}();function getDomain(t){var e=new URL(t).hostname,n=e.split("."),r=n.length;return 2<r&&(e="".concat(n[r-2],".").concat(n[r-1]),2===n[r-2].length&&2===n[r-1].length&&(e="".concat(n[r-3],".").concat(e))),e}var Shr=function(){function t(e,n){_classCallCheck(this,t),this.elements={count:null,trigger:null},is.element(e)?this.elements.trigger=e:is.string(e)&&(this.elements.trigger=document.querySelector(e)),is.element(this.elements.trigger)&&is.empty(this.elements.trigger.shr)&&(this.config=Object.assign({},defaults,n,{networks:constants}),this.init())}return _createClass(t,[{key:"init",value:function(){var t=this;this.console=new Console(this.config.debug),this.storage=new Storage(this.config.storage.key,this.config.storage.ttl,this.config.storage.enabled),this.getCount().then(function(e){return t.displayCount(e)}).catch(function(){}),this.elements.trigger.shr=this}},{key:"share",value:function(t){if(is.event(t)&&!is.empty(this.network)&&this.networkConfig.popup){t.preventDefault();var e=this.networkConfig.popup,n=e.width,r=e.height,o="window-".concat(this.network);if(window[o]&&!window[o].closed)window[o].focus();else{var i=void 0===window.screenLeft?window.screen.left:window.screenLeft,s=void 0===window.screenTop?window.screen.top:window.screenTop,c=window.screen.width/2-n/2+i,u=window.screen.height/2-r/2+s;window[o]=window.open(this.href,this.network,"top=".concat(u,",left=").concat(c,",width=").concat(n,",height=").concat(r)),window[o].focus()}window[o].opener=null}}},{key:"getCount",value:function(){var t=this;return new Promise(function(e,n){var r=t.apiUrl;if(!is.empty(r)){var o=t.url,i=t.storage.get(o);return is.empty(i)?void getJSONP(r).then(function(n){t.storage.set(_defineProperty({},o,n)),e(n)}).catch(n):void e(i)}n(new Error("No URL available for ".concat(t.network,".")))})}},{key:"displayCount",value:function(t){var e=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],n=0,r=this.elements.trigger.getAttribute("data-shr-display");n=is.empty(r)?this.networkConfig.shareCount(t):t[r],is.empty(n)&&(n=0),n=parseInt(n,10),e&&(is.element(this.elements.count)&&(n=parseInt(this.elements.count.innerText,10)),n+=1),this.count=n;var o=this.config.count.position.toLowerCase();if(0<n||this.config.count.displayZero){var i,s="after"===o;i=this.config.count.format&&1e6<n?"".concat(Math.round(n/1e6),"M"):this.config.count.format&&1e3<n?"".concat(Math.round(n/1e3),"K"):formatNumber(n),is.element(this.elements.count)?this.elements.count.textContent=i:(this.elements.trigger.insertAdjacentHTML(s?"afterend":"beforebegin",this.config.count.html(i,this.config.count.classname,o)),this.elements.count=this.elements.trigger[s?"nextSibling":"previousSibling"])}}},{key:"href",get:function(){return is.element(this.elements.trigger)?this.elements.trigger.href:null}},{key:"network",get:function(){var t=this;if(!is.element(this.elements.trigger))return null;var e=this.config.networks;return Object.keys(e).find(function(n){return getDomain(t.href)===e[n].domain})}},{key:"networkConfig",get:function(){return is.empty(this.network)?null:this.config.networks[this.network]}},{key:"url",get:function(){var t=this;if(is.empty(this.network))return null;var e=function(e){return new URL(t.href).searchParams.get(e)};switch(this.network){case"facebook":return e("u");case"github":case"youtube_subscribe":return this.href.pathname;default:return e("url")}}},{key:"apiUrl",get:function(){if(is.empty(this.network))return null;switch(this.network){case"github":return this.networkConfig.url(this.href,this.networkConfig.tokens);case"youtube_subscribe":return this.networkConfig.url(this.networkConfig.channel,this.networkConfig.key);default:return this.networkConfig.url(encodeURIComponent(this.href))}}}],[{key:"setup",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=null;if(is.string(e)?r=Array.from(document.querySelectorAll(e)):is.element(e)?r=[e]:is.nodeList(e)?r=Array.from(e):is.array(e)&&(r=e.filter(is.element)),is.empty(r))return null;var o=Object.assign({},defaults,n);is.string(e)&&o.watch&&new MutationObserver(function(n){Array.from(n).forEach(function(n){Array.from(n.addedNodes).forEach(function(n){is.element(n)&&matches(n,e)&&new t(n,o)})})}).observe(document.body,{childList:!0,subtree:!0});return r.map(function(e){return new t(e,n)})}}]),t}();export default Shr;